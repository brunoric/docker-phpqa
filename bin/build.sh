#!/usr/bin/env bash

_DEFAULT=71
_VERSION=$1
if [ -z "$_VERSION" ]; then
    _VERSION=$_DEFAULT
fi

_master_PHP_VERSION="master"
_master_GPG_KEYS=''
_master_PHP_SHA256=''
_master_CHECK_SIGNATURE=false
_master_CUSTOM_URL=''
_master_REPO_URL="https://github.com/php/php-src/archive/${_master_PHP_VERSION}.zip"

_72_PHP_VERSION="7.2.0RC4"
_72_GPG_KEYS="1729F83938DA44E27BA0F4D3DBDB397470D12172 B1B44D8F021E4E2D6021E995DC9FF8D3EE5AF27F"
_72_PHP_SHA256=''
_72_CHECK_SIGNATURE=false
_72_CUSTOM_URL="https://downloads.php.net/~remi/php-${_72_PHP_VERSION}.tar.xz"
_72_REPO_URL=''

_71_PHP_VERSION="7.1.10"
_71_GPG_KEYS="A917B1ECDA84AEC2B568FED6F50ABC807BD5DCD0 528995BFEDFBA7191D46839EF9BA0ADA31CBD89E"
_71_PHP_SHA256="2b8efa771a2ead0bb3ae67b530ca505b5b286adc873cca9ce97a6e1d6815c50b"
_71_CHECK_SIGNATURE=true
_71_CUSTOM_URL=''
_71_REPO_URL=''

_70_PHP_VERSION="7.0.24"
_70_GPG_KEYS="1A4E8B7277C42E53DBA9C7B9BCAA30EA9C0D5763 6E4F6AB321FDC07F2C332E3AC2BF0BC433CFC8B3"
_70_PHP_SHA256="4dba7aa365193c9229f89f1975fad4c01135d29922a338ffb4a27e840d6f1c98"
_70_CHECK_SIGNATURE=true
_70_CUSTOM_URL=''
_70_REPO_URL=''

_56_PHP_VERSION="5.6.31"
_56_GPG_KEYS="0BD78B5F97500D450838F95DFE857D9A90D90EC1 6E4F6AB321FDC07F2C332E3AC2BF0BC433CFC8B3"
_56_PHP_SHA256="c464af61240a9b7729fabe0314cdbdd5a000a4f0c9bd201f89f8628732fe4ae4"
_56_CHECK_SIGNATURE=true
_56_CUSTOM_URL=''
_56_REPO_URL=''

_55_PHP_VERSION="5.5.38"
_55_GPG_KEYS="0BD78B5F97500D450838F95DFE857D9A90D90EC1 0B96609E270F565C13292B24C13C70B87267B52D"
_55_PHP_SHA256="cb527c44b48343c8557fe2446464ff1d4695155a95601083e5d1f175df95580f"
_55_CHECK_SIGNATURE=true
_55_CUSTOM_URL=''
_55_REPO_URL=''

_PHP_VERSION="_${_VERSION}_PHP_VERSION"
_GPG_KEYS="_${_VERSION}_GPG_KEYS"
_PHP_SHA256="_${_VERSION}_PHP_SHA256"
_CHECK_SIGNATURE="_${_VERSION}_CHECK_SIGNATURE"
_CUSTOM_URL="_${_VERSION}_CUSTOM_URL"
_REPO_URL="_${_VERSION}_REPO_URL"

cd $(git rev-parse --show-toplevel)
docker build \
	--rm=false \
    --build-arg BUILD_PHP_VERSION="${!_PHP_VERSION}" \
    --build-arg BUILD_GPG_KEYS="${!_GPG_KEYS}" \
    --build-arg BUILD_PHP_SHA256="${!_PHP_SHA256}" \
    --build-arg BUILD_CHECK_SIGNATURE="${!_CHECK_SIGNATURE}" \
    --build-arg BUILD_CUSTOM_URL="${!_CUSTOM_URL}" \
    --build-arg BUILD_REPO_URL="${!_REPO_URL}" \
    -t herdphp/phpqa:${_VERSION} src/
cd -